<!DOCTYPE html>
<html>
	<head>
		<title>Countdown</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width">
	<script defer src="./alpinejs-persist-3.10.2-cdn.min.js"></script>
	<script defer src="./alpinejs-3.10.2-cdn.min.js"></script>
	<link rel=stylesheet href="style.css" />
	<link rel=manifest href="counter.webmanifest">
	<script src="main.js"></script>
	<link rel="shortcut icon" href="data:image/x-icon;," type="image/x-icon">
</head>
<body>

	<div x-data="{ timers: $persist([]), popular: $persist({'endtime': [], 'countdown':[]}), curr_time: Date.now(), init() { c14n_timers(this.timers) ; setInterval(() => { c14n_timers(this.timers) ; this.curr_time = Date.now(); }, 1000); } }">
	<template x-for="timer in timers" :key="timer.timer_id">
		<div class=individual_timer x-data="{ timer_id: timer.timer_id, duration_ms: (timer.end - timer.start), start_ms: timer.start, end_ms: timer.end, start: new Date(timer.start), end: new Date(timer.end), duration: timer.end-timer.start }">
			<div class=firstrow>
				<span class=fraction x-text="fraction(duration_ms, curr_time-timer.start).toFixed(3)"></span>
				<span class=duration x-text="fmt_duration(end - curr_time)"></span>
			</div>
			<div class=remaining>
				Start: <span x-text="`${start.getHours().toString().padStart(2, '0')}:${start.getMinutes().toString().padStart(2, '0')}`"></span> End: <span x-text="`${end.getHours().toString().padStart(2, '0')}:${end.getMinutes().toString().padStart(2, '0')}`"></span>.
			</div>
			<div>
				Raw time left: <span x-text="end_ms - curr_time"></span> ms <span x-text="Math.floor((end_ms - curr_time)/1000)"></span> sec
			</div>
			<button @click="remove_timer(timers, timer.timer_id)">Delete (id <span x-text="timer_id"></span>)</button>
		<div>
	</template>

	<div id=add_forms>
		<form name=add_endtime @submit.prevent="add_endtime(timers, $event.target)">
			Endtime: <input type=time name=endtime value="18:00">
			<button submit>Add</button>
		</form>
		<form name=add_countdown @submit.prevent="add_countdown(timers, $event.target, popular)">
			<input type=number name=hours min=0 value=1 size=3>h <input type=number name=minutes value=0 size=3 min=0 >m
			<button submit>Add</button>
		</form>
		<button @click="timers = []; popular = {}">Reset</button>
		<details open><summary>State:</summary>
			<code x-text="JSON.stringify(timers)"></code>
			<code x-text="JSON.stringify(popular)"></code>
		</details>
	</div>

</div>

</div>

</body>
</html>
